<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO 콘텐츠 실행 계획 및 체크리스트</title>
    <!-- Tailwind CSS CDN 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter 폰트 설정 */
        :root { font-family: 'Inter', sans-serif; }
        /* 커스텀 체크박스 스타일링 */
        .custom-checkbox {
            appearance: none;
            width: 1.25rem; /* 20px */
            height: 1.25rem;
            border: 2px solid #3b82f6; /* blue-500 */
            border-radius: 0.25rem; /* rounded */
            transition: all 0.2s;
            cursor: pointer;
            flex-shrink: 0;
        }
        .custom-checkbox:checked {
            background-color: #3b82f6;
            border-color: #3b82f6;
            position: relative;
        }
        .custom-checkbox:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.875rem; /* 14px */
            font-weight: bold;
        }
        .item-checked .factor-text {
            text-decoration: line-through;
            color: #9ca3af; /* gray-400 */
        }
        .explanation-text {
            color: #6b7280; /* gray-500 */
        }
        .section-header {
            border-left: 4px solid #3b82f6;
            padding-left: 1rem;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#3b82f6',
                        'secondary': '#10b981',
                        'background': '#f4f7f9', // 밝은 배경색
                        'card-bg': '#ffffff',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen p-4 text-gray-900 bg-background md:p-8">

    <div id="app" class="mx-auto max-w-7xl">
        
        <header class="mb-10 text-center">
            <h1 class="mb-2 text-4xl font-extrabold text-gray-900">
                자산 분석 & SEO 콘텐츠 실행 계획
            </h1>
            <p class="text-xl text-gray-600">
                최신 뉴스 기반의 자산 분석글을 SEO 최적화 체크리스트와 함께 작성합니다.
            </p>
        </header>

        <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">
            
            <!-- 좌측: 콘텐츠 작성 폼 (Editor) -->
            <main class="lg:col-span-2">
                <div class="p-8 border border-gray-100 shadow-2xl bg-card-bg rounded-2xl">
                    <h2 class="mb-6 text-2xl font-bold text-gray-800 section-header">1. 콘텐츠 작성 및 DB 연동 데이터</h2>
                    <form id="content-form" class="space-y-6">
                        
                        <!-- 자산 연결 및 생성 관련 정보 -->
                        <div class="p-4 border border-gray-200 rounded-lg shadow-inner bg-gray-50">
                            <label for="asset-type" class="block mb-2 text-sm font-medium text-gray-700">콘텐츠 유형/자산 선택</label>
                            <div class="flex flex-wrap items-center gap-4">
                                <select id="asset-type" class="flex-1 min-w-[150px] px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                    <option value="blog">일반 블로그 게시물</option>
                                    <option value="asset_page">자산 상세 설명 페이지</option>
                                </select>
                                <input type="text" id="related-asset" class="flex-1 min-w-[200px] px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary" placeholder="관련 자산 Ticker (예: MSFT, BTC)">
                            </div>
                        </div>

                        <!-- SEO 메타데이터 영역 -->
                        <div class="space-y-4">
                            <h3 class="pb-2 text-xl font-semibold text-gray-800 border-b">SEO 메타 정보</h3>
                            <div>
                                <label for="page-title" class="block text-sm font-medium text-gray-700">페이지 제목 (Title Tag) <span id="title-count" class="text-xs text-gray-500">(0 / 60자 권장)</span></label>
                                <input type="text" id="page-title" maxlength="100" class="block w-full px-4 py-2 mt-1 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-base" placeholder="핵심 키워드를 포함하여 60자 내외로 작성">
                            </div>
                            <div>
                                <label for="meta-description" class="block text-sm font-medium text-gray-700">메타 설명 (Meta Description) <span id="desc-count" class="text-xs text-gray-500">(0 / 155자 권장)</span></label>
                                <textarea id="meta-description" rows="3" maxlength="200" class="block w-full px-4 py-2 mt-1 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-base" placeholder="검색 결과 클릭을 유도하는 매력적인 문구 (155자 내외)"></textarea>
                            </div>
                            <div>
                                <label for="page-slug" class="block text-sm font-medium text-gray-700">URL 슬러그 (영문, 소문자, 하이픈) <span id="slug-preview" class="text-xs text-secondary">(미리보기)</span></label>
                                <input type="text" id="page-slug" class="block w-full px-4 py-2 mt-1 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-base" placeholder="slug-for-the-post">
                            </div>
                        </div>

                        <!-- 메인 콘텐츠 영역 -->
                        <div>
                            <h3 class="pb-2 mb-4 text-xl font-semibold text-gray-800 border-b">메인 콘텐츠 (Markdown/HTML 에디터 자리)</h3>
                            <div class="p-3 mb-4 text-sm text-yellow-800 bg-yellow-100 rounded-lg" role="alert">
                                **뉴스 통합/재작성 기능:** Gemini API 등을 활용하여 외부 뉴스 5개를 통합하고 의견을 더한 초안 생성 기능을 여기에 통합합니다. (현재는 에디터 자리만 표시)
                            </div>
                            <textarea id="main-content" rows="18" class="block w-full h-auto px-4 py-3 mt-1 bg-white border border-gray-300 rounded-lg shadow-sm resize-y focus:outline-none focus:ring-secondary focus:border-secondary sm:text-base" placeholder="여기에 글을 작성하세요. SEO 최적화를 위해 H1 태그는 페이지 제목과 일치하거나 유사하게, 페이지당 하나만 사용해야 합니다."></textarea>
                        </div>

                        <!-- 발행 버튼 -->
                        <div class="flex justify-end pt-4 space-x-3 border-t border-gray-200">
                            <button type="button" class="px-6 py-2 font-semibold text-gray-700 transition duration-150 bg-gray-200 rounded-lg hover:bg-gray-300">임시 저장 (Draft)</button>
                            <button type="submit" class="px-6 py-2 font-bold text-white transition duration-150 rounded-lg bg-primary hover:bg-blue-700">발행하기 (Publish)</button>
                        </div>
                    </form>
                </div>
            </main>

            <!-- 우측: SEO 체크리스트 (Sticky) -->
            <aside class="lg:col-span-1">
                <div class="sticky top-8">
                    <div class="p-6 border border-gray-100 shadow-2xl bg-card-bg rounded-2xl">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-gray-800">SEO 체크리스트 (점검)</h2>
                            <button id="reset-button" class="text-sm text-red-500 transition duration-150 hover:text-red-700">체크 초기화</button>
                        </div>
                        <div id="checklist-container" class="space-y-3 max-h-[80vh] overflow-y-auto pr-2">
                            <!-- 체크리스트 아이템들이 여기에 렌더링됩니다 -->
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // NOTE: 로컬 저장소 대신, 실제 프로젝트에서는 Firestore 또는 FastAPI DB에 연결하여
        // 사용자의 체크리스트 상태를 User 또는 BlogPost 모델에 저장해야 합니다.

        // SEO 체크리스트 데이터 (실행 계획)
        const seoChecklistData = [
            {
                category: '자산 및 콘텐츠 연결',
                items: [
                    { factorKor: '주요 자산 (Asset ID)과 정확하게 연결 완료', explanation: '이 콘텐츠를 연결할 자산 정보를 DB에 기록합니다.', id: 'asset-1', importance: 'High' },
                    { factorKor: 'DB에 slug (URL) 중복 여부 확인 완료', explanation: 'URL은 사이트 전체에서 고유해야 합니다. DB에서 확인합니다.', id: 'asset-2', importance: 'High' },
                    { factorKor: '타겟 키워드와 자산 주제의 연관성 최고 등급', explanation: '검색 의도에 완벽하게 부합하는 콘텐츠입니다.', id: 'asset-3', importance: 'High' },
                    { factorKor: '뉴스 통합 및 재작성 초안 검토 완료', explanation: 'LLM 등으로 생성된 초안의 사실 관계 및 톤 앤 매너를 검토합니다.', id: 'asset-4', importance: 'Medium' },
                ]
            },
            {
                category: '개별 페이지 SEO (On-Page)',
                items: [
                    { factorKor: '제목 태그 (Title Tag) 최적화 (60자 내외)', factorEn: 'Keyword in Title Tag', explanation: '핵심 키워드를 제목 앞부분에 배치하고 60자 내외로 작성합니다.', id: 'content-1', importance: 'High' },
                    { factorKor: '메타 설명 (Meta Description) 매력적 작성 (155자 내외)', factorEn: 'Meta Description for CTR', explanation: 'CTR 유도를 위해 매력적으로 작성합니다.', id: 'content-5', importance: 'Medium' },
                    { factorKor: 'H1 태그 사용 확인 (페이지당 1개)', factorEn: 'H1 Tag Usage', explanation: '페이지 주제를 명확히 하고 키워드를 포함합니다.', id: 'content-2', importance: 'High' },
                    { factorKor: '부제목 (H2, H3, ...) 체계적 사용', factorEn: 'H2, H3 Tag Usage', explanation: '긴 글의 가독성을 높이고 롱테일 키워드를 포함합니다.', id: 'content-8', importance: 'Medium' },
                    { factorKor: '충분한 콘텐츠 길이 및 심층적 내용', factorEn: 'Content Length and Depth', explanation: '경쟁사보다 심도 있고 포괄적인 내용을 다룹니다 (최소 1,000단어 권장).', id: 'content-3', importance: 'High' },
                    { factorKor: '이미지 Alt 태그 필수 사용 및 설명 포함', factorEn: 'Image Alt Tag Usage', explanation: '이미지 내용을 설명하여 접근성을 높이고 이미지 검색에 노출됩니다.', id: 'content-4', importance: 'Medium' },
                    { factorKor: '관련 내부 링크 (Internal Links) 2개 이상 포함', factorEn: 'Internal Links', explanation: '다른 관련 글/자산 페이지로 유기적인 연결을 유도합니다.', id: 'frontend-4', importance: 'Medium' },
                    { factorKor: '권위 있는 외부 링크 (Outbound Links) 포함', factorEn: 'Outbound Links', explanation: 'Google에게 콘텐츠의 신뢰도 신호가 됩니다. 출처를 명확히 합니다.', id: 'content-9', importance: 'Low' },
                ]
            },
            {
                category: '기술 및 품질 (QA)',
                items: [
                    { factorKor: '모바일 반응형 레이아웃 확인', factorEn: 'Mobile-Friendly Design QA', explanation: '모바일 기기에서 글이 잘리는 부분 없이 최적화되었는지 최종 확인합니다.', id: 'frontend-2-qa', importance: 'High' },
                    { factorKor: '문법 및 스펠링 오류 없음', factorEn: 'Spelling and Grammar Check', explanation: '최종 검토를 완료했습니다.', id: 'content-12-qa', importance: 'High' },
                    { factorKor: '실제 로딩 속도 예상 점검 (PageSpeed Insight)', factorEn: 'Page Loading Speed Test', explanation: 'Next.js의 SSG를 활용했더라도 최종 성능을 확인합니다.', id: 'frontend-3-qa', importance: 'Medium' },
                    { factorKor: '발행 후 Google Search Console 수동 색인 요청', factorEn: 'Manual Indexing Request', explanation: '콘텐츠 발행 후 빠르게 검색 결과에 노출되도록 요청합니다.', id: 'tech-1', importance: 'High' },
                ]
            }
        ];

        /**
         * 로컬 저장소에서 체크 상태를 로드합니다.
         * @returns {Object} 체크된 아이템 ID를 담은 객체.
         */
        const loadCheckState = () => {
            try {
                // 특정 키를 사용하여 로컬 저장소에 저장
                const storedState = localStorage.getItem('seoWriteChecklistState_V2');
                return storedState ? JSON.parse(storedState) : {};
            } catch (e) {
                console.error("Failed to load state from localStorage:", e);
                return {};
            }
        };

        /**
         * 체크 상태를 로컬 저장소에 저장합니다.
         * @param {Object} state - 저장할 체크 상태 객체.
         */
        const saveCheckState = (state) => {
            try {
                localStorage.setItem('seoWriteChecklistState_V2', JSON.stringify(state));
            } catch (e) {
                console.error("Failed to save state to localStorage:", e);
            }
        };

        /**
         * 체크리스트 아이템을 렌더링하고 상태를 적용합니다.
         */
        const renderChecklist = () => {
            const container = document.getElementById('checklist-container');
            if (!container) return;
            
            const checkedState = loadCheckState();
            
            container.innerHTML = ''; 

            const listFragment = document.createDocumentFragment();

            seoChecklistData.forEach(categoryData => {
                // 카테고리 제목 추가
                const categoryTitle = document.createElement('h3');
                categoryTitle.className = 'text-lg font-extrabold text-gray-700 pt-4 pb-2 border-b border-gray-200 sticky top-0 bg-card-bg z-10 shadow-sm';
                categoryTitle.textContent = categoryData.category;
                listFragment.appendChild(categoryTitle);

                // 카테고리 아이템 렌더링
                categoryData.items.forEach(item => {
                    const isChecked = !!checkedState[item.id];
                    
                    const itemDiv = document.createElement('div');
                    itemDiv.id = `item-${item.id}`;
                    itemDiv.className = `py-2 transition duration-150 ease-in-out ${isChecked ? 'item-checked' : ''}`;
                    
                    const label = document.createElement('label');
                    label.htmlFor = `check-${item.id}`;
                    label.className = 'flex items-start cursor-pointer';

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `check-${item.id}`;
                    checkbox.checked = isChecked;
                    // Note: window.confirm()을 사용하지 않도록 주의
                    checkbox.className = 'custom-checkbox mr-3 mt-1'; 
                    checkbox.dataset.itemId = item.id;
                    
                    const textContent = document.createElement('div');
                    textContent.className = 'flex-1 min-w-0';
                    
                    const factorKor = document.createElement('p');
                    factorKor.className = 'factor-text text-sm font-bold text-gray-800 break-words flex items-center';
                    
                    const importanceBadge = document.createElement('span');
                    importanceBadge.className = `ml-2 px-2 py-0.5 text-xs font-semibold rounded-full ${
                        item.importance === 'High' ? 'bg-red-100 text-red-800' : 
                        item.importance === 'Medium' ? 'bg-yellow-100 text-yellow-800' :
                        'bg-green-100 text-green-800'
                    }`;
                    importanceBadge.textContent = item.importance;
                    
                    factorKor.textContent = item.factorKor;
                    factorKor.appendChild(importanceBadge);

                    const explanation = document.createElement('p');
                    explanation.className = 'explanation-text text-xs mt-1 break-words';
                    explanation.textContent = item.explanation;
                    
                    textContent.appendChild(factorKor);
                    textContent.appendChild(explanation);

                    label.appendChild(checkbox);
                    label.appendChild(textContent);
                    
                    itemDiv.appendChild(label);
                    listFragment.appendChild(itemDiv);
                });
            });

            container.appendChild(listFragment);
        };

        /**
         * 체크박스 클릭 이벤트를 처리하고 상태를 업데이트합니다.
         * @param {Event} event - 이벤트 객체.
         */
        const handleCheckboxClick = (event) => {
            if (event.target.classList.contains('custom-checkbox')) {
                const itemId = event.target.dataset.itemId;
                const isChecked = event.target.checked;
                
                const checkedState = loadCheckState();
                
                if (isChecked) {
                    checkedState[itemId] = true;
                } else {
                    delete checkedState[itemId];
                }

                saveCheckState(checkedState);
                
                // UI 업데이트
                const itemDiv = document.getElementById(`item-${itemId}`);
                if (itemDiv) {
                    itemDiv.classList.toggle('item-checked', isChecked);
                }
            }
        };

        /**
         * 텍스트 입력 시 글자 수를 업데이트하고 슬러그를 자동 생성/미리보기 합니다.
         */
        const handleInput = (event) => {
            const targetId = event.target.id;
            const value = event.target.value;

            if (targetId === 'page-title') {
                document.getElementById('title-count').textContent = `(${value.length} / 60자 권장)`;
                
                // 페이지 제목을 기반으로 슬러그 자동 업데이트 (간단한 로직)
                const slugInput = document.getElementById('page-slug');
                if (slugInput.value.length === 0) { // 슬러그가 비어있을 때만 자동 생성
                    const generatedSlug = value.toLowerCase()
                                            .replace(/[^a-z0-9\s-]/g, '') // 영문, 숫자, 공백, 하이픈 외 제거
                                            .trim()
                                            .replace(/\s+/g, '-'); // 공백을 하이픈으로 변경
                    document.getElementById('slug-preview').textContent = `/${generatedSlug}`;
                }

            } else if (targetId === 'meta-description') {
                document.getElementById('desc-count').textContent = `(${value.length} / 155자 권장)`;
            
            } else if (targetId === 'page-slug') {
                document.getElementById('slug-preview').textContent = `/${value.toLowerCase().replace(/\s+/g, '-')}`;
            }
        };
        
        /**
         * 모든 체크 상태를 초기화합니다.
         */
        const handleReset = () => {
            // 사용자에게 초기화 여부를 확인하는 커스텀 모달 또는 메시지를 표시해야 합니다.
            // 여기서는 임시적으로 confirm() 대신 메시지 박스로 대체합니다.
            if (confirm("체크리스트 상태를 초기화하시겠습니까?")) {
                 localStorage.removeItem('seoWriteChecklistState_V2');
                 renderChecklist();
            } else {
                console.log("체크리스트 초기화가 취소되었습니다.");
            }
        };

        // DOMContentLoaded에서 초기화 함수 호출 및 이벤트 리스너 설정
        document.addEventListener('DOMContentLoaded', () => {
            renderChecklist();

            // 이벤트 리스너 부착
            const checklistContainer = document.getElementById('checklist-container');
            const resetButton = document.getElementById('reset-button');
            const form = document.getElementById('content-form');
            const pageTitleInput = document.getElementById('page-title');
            const metaDescInput = document.getElementById('meta-description');
            const pageSlugInput = document.getElementById('page-slug');
            const mainContent = document.getElementById('main-content');
            
            if (checklistContainer) {
                checklistContainer.addEventListener('click', handleCheckboxClick);
            }
            if (resetButton) {
                resetButton.addEventListener('click', handleReset);
            }
            if (pageTitleInput) {
                pageTitleInput.addEventListener('input', handleInput);
            }
            if (metaDescInput) {
                metaDescInput.addEventListener('input', handleInput);
            }
            if (pageSlugInput) {
                pageSlugInput.addEventListener('input', handleInput);
            }
            // 폼 제출 이벤트는 실제 백엔드 API 호출 로직과 연결되어야 합니다.
            if (form) {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    console.log("게시물 발행 시도...");
                    
                    // DB API 호출 로직 (예시)
                    // const postData = {
                    //    title: pageTitleInput.value,
                    //    content: mainContent.value,
                    //    ...
                    // };
                    // fetchWrapper.post('/v1/blog', postData).then(...)

                    alert("발행 기능은 백엔드 API 연동이 필요합니다. 현재는 콘솔에 로그만 출력됩니다.");
                });
            }
        });
    </script>
</body>
